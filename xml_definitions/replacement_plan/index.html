<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.png">
        

	<title>Replacement plan - Snom io Knowledge base</title>

        <link href="../../css/bootstrap-3.0.3.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic,500,100,100italic' rel='stylesheet' type='text/css'>
        <link href="../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-1331074-26', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="navbar-container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../.."><img height="70px" src="/img/knowledgebase.png" alt="site_name"/></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">XML Minibrowser <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            
<li >
    <a href="../../xml_minibrowser/">Introduction</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../xml_minibrowser/">Introduction</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../../xml_minibrowser/triggering/">Triggering an application</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../xml_minibrowser/triggering/">Triggering an application</a>
                        </li>
                        -->
                    
                        
                            
    <li class="dropdown-submenu">
    <a>Main tags</a>
    <ul class="dropdown-menu">
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneMenu/">SnomIPPhoneMenu</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneDirectory/">SnomIPPhoneDirectory</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneText/">SnomIPPhoneText</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneImage/">SnomIPPhoneImage</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneImageFile/">SnomIPPhoneImageFile</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneInput/">SnomIPPhoneInput</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/SnomIPPhoneBatch/">SnomIPPhoneBatch</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/main_sub_tags/">Main Sub Tags</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/main_tags/MainAttributes/">Main Attributes</a>
</li>

            
        
    </ul>
  </li>

                        
                        <!-- ORIG
                        <li >
                            <a href="">Main tags</a>
                        </li>
                        -->
                    
                        
                            
    <li class="dropdown-submenu">
    <a>Callbacks</a>
    <ul class="dropdown-menu">
        
            
                
<li >
    <a href="../../xml_minibrowser/callbacks/">Introduction</a>
</li>

            
        
            
        
    </ul>
  </li>

                        
                        <!-- ORIG
                        <li >
                            <a href="">Callbacks</a>
                        </li>
                        -->
                    
                        
                            
    <li class="dropdown-submenu">
    <a>Fragments</a>
    <ul class="dropdown-menu">
        
            
                
<li >
    <a href="../../xml_minibrowser/fragments/">Introduction</a>
</li>

            
        
            
        
    </ul>
  </li>

                        
                        <!-- ORIG
                        <li >
                            <a href="">Fragments</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../../xml_minibrowser/templates/">Builtin Templates</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../xml_minibrowser/templates/">Builtin Templates</a>
                        </li>
                        -->
                    
                        
                            
    <li class="dropdown-submenu">
    <a>Examples</a>
    <ul class="dropdown-menu">
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/">Introduction</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneText/">SnomIPPhoneText</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneMenu/">SnomIPPhoneMenu</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/InputField/">InputField</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneDirectory/">SnomIPPhoneDirectory</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneInput/">SnomIPPhoneInput</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneImage/">SnomIPPhoneImage</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneImageFile/">SnomIPPhoneImageFile</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/SnomIPPhoneBatch/">SnomIPPhoneBatch</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/main_subelements/">Main sub elements</a>
</li>

            
        
            
                
<li >
    <a href="../../xml_minibrowser/examples/main_elements_attributes/">Main elements attributes</a>
</li>

            
        
    </ul>
  </li>

                        
                        <!-- ORIG
                        <li >
                            <a href="">Examples</a>
                        </li>
                        -->
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">XML Definitions <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            
<li >
    <a href="../">XML Definitions</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../">XML Definitions</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../functions/">Functions</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../functions/">Functions</a>
                        </li>
                        -->
                    
                        
                            
<li class="active">
    <a href="./">Replacement plan</a>
</li>

                        
                        <!-- ORIG
                        <li class="active">
                            <a href="./">Replacement plan</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../debug/">Debug</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../debug/">Debug</a>
                        </li>
                        -->
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Awesome Snom io <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
                            
<li >
    <a href="../../awesome/list/">The Awesome list</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../awesome/list/">The Awesome list</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../../awesome/howto-contribute/">How to contribute</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../awesome/howto-contribute/">How to contribute</a>
                        </li>
                        -->
                    
                        
                            
<li >
    <a href="../../awesome/about/">About</a>
</li>

                        
                        <!-- ORIG
                        <li >
                            <a href="../../awesome/about/">About</a>
                        </li>
                        -->
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../functions/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../debug/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/Snomio/Documentation">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>
                <div class="breadcrumb-container">
            <ol class="breadcrumb">
                
                    
                        
                            
                                <li>XML Definitions &raquo;</li>
                            
                        
                    

                    <li>Replacement plan</li>
                
            </ol>
        </div>

        <div class="container">
            
                <div class="col-md-3">
                    <div class="bs-sidebar hidden-print affix well" role="complementary">
                            
                        <ul class="nav bs-sidenav">
                                    
            <li class="level1 active"><a href="#replacement_plan">Replacement plan</a></li>
            
        
                        </ul>
                    </div>
                </div>
            

            
                <div class="col-md-9" role="main">

<h1 id="replacement_plan">Replacement plan<a class="headerlink" href="#replacement_plan" title="Permanent link"> #</a></h1>
<p>Sometimes the build-in Function key behaviors doesn't meet our requirements and we would not like to write a XML Definition Code each time again to put it on our phones. That is why snom phones have <strong>replacement_plan</strong> elements. Which allow you to change the default functionality of a Function key to your own (designed with XML Definition Code).</p>
<p>Below we are going to show you an example which is used by our Broadsoft customers and is replacing the <strong>Contact Buddy List</strong> option.</p>
<p><strong>NOTE:</strong> That this needs to be uploaded to the phone with Provisioning, either in the <em><settings></em> tag or as an individual XML file which is being listed in the <em><settings-files></em> tag.</p>
<pre class="code"><code class="language-xml">&lt;ReplacementPlan&gt;
  &lt;key id=&quot;ResourceListBuddy&quot; wui_translation_key=&quot;fkeys_ssi_buddy_from_server_list&quot;/&gt;
  &lt;/key&gt;
  &lt;setting_replacement id=&quot;user_event_list_uri&quot;/&gt;
  &lt;/setting_replacement&gt;
&lt;/ReplacementPlan&gt;</code></pre>


<p>The replacement plans start with a <strong>ReplacmentPlan</strong> root element container, which can have one or more <strong>key</strong> and <strong>setting_replacement</strong> element containers.</p>
<p><strong>key</strong> element container defines a key type which will be displayed in the Web User Interface on the Function key page and contains two attributes. <strong>id</strong> is a identifier which is used for deleting or altering the keys later and <strong>wui_translation_key</strong> is used to find the correct translation for the key when it's listed in the Web User Interface. </p>
<p><strong>NOTE:</strong> If the <strong>wui_translation_key</strong> is not part of the translation-map, it will be used directly to describe the key in the Web User Interface.</p>
<pre class="code"><code class="language-xml">&lt;ReplacementPlan&gt;
    &lt;key id=&quot;ResourceListBuddy&quot; wui_translation_key=&quot;fkeys_ssi_buddy_from_server_list&quot;&gt;
    &lt;general type='ResourceListBuddy'/&gt;
    &lt;initialization&gt;
        &lt;variable name='ui_argument' value=''/&gt;
        &lt;variable name='ui_label' value=''/&gt;
        &lt;state value='initial'/&gt;
    &lt;/initialization&gt;
    &lt;NotifyParsingRules type='applies'&gt;
        &lt;level1 translates_to='OK'&gt;Header:Content-ID==&lt;$(ResourceCid)&gt;&lt;/level1&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='state'&gt;
        &lt;level1 translates_to='ringing'&gt;/dialog-info/dialog/state[.='early']&lt;/level1&gt;
        &lt;level1-1 translates_to='calling'&gt;/dialog-info/dialog[@direction='initiator']&lt;/level1-1&gt;
        &lt;level2 translates_to='ringing'&gt;/dialog-info/dialog/state[.='proceeding']&lt;/level2&gt;
        &lt;level2-1 translates_to='calling'&gt;/dialog-info/dialog[@direction='initiator']&lt;/level2-1&gt;
        &lt;level3 translates_to='in_a_call'&gt;/dialog-info/dialog/state[.='confirmed']&lt;/level3&gt;
        &lt;level4 translates_to='offhook'&gt;/dialog-info/dialog/state[.='trying']&lt;/level4&gt;
        &lt;default translates_to='free'/&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='array' id='local_uris'&gt;
        &lt;level1 fetch_attribute='uri'&gt;/dialog-info/dialog/local/target[@uri]&lt;/level1&gt;
        &lt;level2 fetch_content='true'&gt;/dialog-info/dialog/local/identity&lt;/level2&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='variable' id='label'&gt;
        &lt;level1 fetch_attribute='display'&gt;/dialog-info/dialog/local/identity[@display]&lt;/level1&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;action&gt;
        &lt;assign when='on notify'&gt;
            &lt;source value=''/&gt;
            &lt;destination id='call_me_uri'/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='local_uris'/&gt;
            &lt;destination id='call_me_uri' require1='$(local_uris[$(index)])&gt;=tel:' require2='$(local_uris[$(index)])&lt;tel;'/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='local_uris'/&gt;
            &lt;destination id='call_me_uri' require1='$(call_me_uri)=='/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='call_me_uri' value_match='.*ext=(.*)' value_replace='*97$1'/&gt;
            &lt;destination id='pick_up_tel'/&gt;
        &lt;/assign&gt;
        &lt;dial target='$(pick_up_tel)' when='on press' state='ringing'/&gt;
        &lt;dial target='$(call_me_uri)' when='on press'/&gt;
        &lt;/action&gt;
    &lt;/key&gt;
    &lt;setting_replacement id=&quot;user_event_list_uri&quot;&gt;
    &lt;/setting_replacement&gt;
&lt;/ReplacementPlan&gt;</code></pre>


<p>We added a regular XML Definition Code into our <strong>key</strong> element container, which is parsing our NOTIFY and assign values to our variables. Maybe you already saw that in the above Code there is no <strong>subscription</strong> element and you ask yourselves how are we going to subscribe for notifies. So since we want it to be dynamic and allow users to enter their own value where to subscribe we are going to put it into the <strong>settings_replacment</strong> element container.</p>
<p><strong>setting_replacment</strong> element container contains the XML Definition Code which will be used if the setting is set. This element container has one attribute named <strong>id</strong>, which tells the phone which setting behavior should be replaced. </p>
<p>At the moment the only valid ID (setting) is <strong>user_event_list_uri</strong>. Also this element container has two Public variables which contain our Setting Value and index of our identity. </p>
<pre class="code"><code class="language-xml">&lt;ReplacementPlan&gt;
    &lt;key id=&quot;ResourceListBuddy&quot; wui_translation_key=&quot;fkeys_ssi_buddy_from_server_list&quot;&gt;
    &lt;general type='ResourceListBuddy'/&gt;
    &lt;initialization&gt;
        &lt;variable name='ui_argument' value=''/&gt;
        &lt;variable name='ui_label' value=''/&gt;
        &lt;state value='initial'/&gt;
    &lt;/initialization&gt;
    &lt;NotifyParsingRules type='applies'&gt;
        &lt;level1 translates_to='OK'&gt;Header:Content-ID==&lt;$(ResourceCid)&gt;&lt;/level1&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='state'&gt;
        &lt;level1 translates_to='ringing'&gt;/dialog-info/dialog/state[.='early']&lt;/level1&gt;
        &lt;level1-1 translates_to='calling'&gt;/dialog-info/dialog[@direction='initiator']&lt;/level1-1&gt;
        &lt;level2 translates_to='ringing'&gt;/dialog-info/dialog/state[.='proceeding']&lt;/level2&gt;
        &lt;level2-1 translates_to='calling'&gt;/dialog-info/dialog[@direction='initiator']&lt;/level2-1&gt;
        &lt;level3 translates_to='in_a_call'&gt;/dialog-info/dialog/state[.='confirmed']&lt;/level3&gt;
        &lt;level4 translates_to='offhook'&gt;/dialog-info/dialog/state[.='trying']&lt;/level4&gt;
        &lt;default translates_to='free'/&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='array' id='local_uris'&gt;
        &lt;level1 fetch_attribute='uri'&gt;/dialog-info/dialog/local/target[@uri]&lt;/level1&gt;
        &lt;level2 fetch_content='true'&gt;/dialog-info/dialog/local/identity&lt;/level2&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;NotifyParsingRules type='variable' id='label'&gt;
        &lt;level1 fetch_attribute='display'&gt;/dialog-info/dialog/local/identity[@display]&lt;/level1&gt;
    &lt;/NotifyParsingRules&gt;
    &lt;action&gt;
        &lt;assign when='on notify'&gt;
            &lt;source value=''/&gt;
            &lt;destination id='call_me_uri'/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='local_uris'/&gt;
            &lt;destination id='call_me_uri' require1='$(local_uris[$(index)])&gt;=tel:' require2='$(local_uris[$(index)])&lt;tel;'/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='local_uris'/&gt;
            &lt;destination id='call_me_uri' require1='$(call_me_uri)=='/&gt;
        &lt;/assign&gt;
        &lt;assign when='on notify'&gt;
            &lt;source id='call_me_uri' value_match='.*ext=(.*)' value_replace='*97$1'/&gt;
            &lt;destination id='pick_up_tel'/&gt;
        &lt;/assign&gt;
        &lt;dial target='$(pick_up_tel)' when='on press' state='ringing'/&gt;
        &lt;dial target='$(call_me_uri)' when='on press'/&gt;
        &lt;/action&gt;
    &lt;/key&gt;
    &lt;setting_replacement id=&quot;user_event_list_uri&quot;&gt;
        &lt;general type='ResourceListSubscription'/&gt;
        &lt;initialization&gt;
            &lt;variable name='setting_value' value=''/&gt;
            &lt;variable name='setting_index' value=''/&gt;
            &lt;identity value='$(setting_index)'/&gt;
            &lt;variable name='subscr_uri' value='sip:$(setting_value);user=phone'/&gt;
            &lt;state value='initial'/&gt;
        &lt;/initialization&gt;
        &lt;subscription type='dialog-list' to='&lt;$(subscr_uri)&gt;' for='$(subscr_uri)'/&gt;
        &lt;NotifyParsingRules type='applies'&gt;
            &lt;level1 translates_to='OK'&gt;/list[@uri='$(subscr_uri)']&lt;/level1&gt;
        &lt;/NotifyParsingRules&gt;
        &lt;NotifyParsingRules type='state'&gt;
            &lt;level1 translates_to='full'&gt;/list[@fullState='true']&lt;/level1&gt;
            &lt;level2 translates_to='partial'/&gt;
        &lt;/NotifyParsingRules&gt;
        &lt;NotifyParsingRules type='array' id='cids'&gt;
            &lt;level1 fetch_attribute='cid'&gt;/list/resource/instance&lt;/level1&gt;
        &lt;/NotifyParsingRules&gt;
        &lt;NotifyParsingRules type='array' id='uris'&gt;
            &lt;level1 fetch_attribute='uri'&gt;/list/resource&lt;/level1&gt;
        &lt;/NotifyParsingRules&gt;
        &lt;action&gt;
            &lt;assign state='full'&gt;
                &lt;source value='no buddy'/&gt;
                &lt;destination context='all' id='state' require1='${type}==ResourceListBuddy'/&gt;
            &lt;/assign&gt;
            &lt;assign state='full'&gt;
                &lt;source value=''/&gt;
                &lt;destination context='all' id='BuddyUri' require1='${type}==ResourceListBuddy'/&gt;
            &lt;/assign&gt;
            &lt;assign state='full'&gt;
                &lt;source context='local' id='uris'/&gt;
                &lt;destination context='all' id='BuddyUri' require1='${type}==ResourceListBuddy' require2='${BuddyUri}=='/&gt;
            &lt;/assign&gt;
            &lt;assign when='on notify'&gt;
                &lt;source context='local' id='cids'/&gt;
                &lt;destination context='all' id='ResourceCid' require1='${type}==ResourceListBuddy' require2='${BuddyUri}==$(uris[$(index)])'/&gt;
            &lt;/assign&gt;
        &lt;/action&gt;
    &lt;/setting_replacement&gt;
&lt;/ReplacementPlan&gt;</code></pre>


<p>We added the XML Definition Code which will make a SUBSCRIBE to your <strong>dialog-list</strong> events and parse the NOTIFYs to our new Variables which we automatically thanks to the Referencing send to our Function keys with our type we defined in the <strong>id</strong> attribute of our <strong>key</strong> element container.</p>
<pre class="code"><code class="language-xml">&lt;initialization&gt;
    &lt;variable name='setting_value' value=''/&gt;
    &lt;variable name='setting_index' value=''/&gt;
    &lt;identity value='$(setting_index)'/&gt;
    &lt;variable name='subscr_uri' value='sip:$(setting_value);user=phone'/&gt;
    &lt;state value='initial'/&gt;
&lt;/initialization&gt;</code></pre>


<p>These two new variables are not mandatory; if our XML Definition Code doesn't contain them in <strong>initialization</strong> element container then they will be automatically added to the code. Or if there already set, the values will be updated with the values of our setting. </p></div>
            
        </div>

    <footer class="col-md-12">
        <hr>
        
        <center>Copyright © 2016 Snom Technology AG. All rights reserved.</center>
        
    </footer>


        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>